{% extends "base.html" %}
{% load static %}
{% block title %}Registro de reserva — {{ room.name }}{% endblock %}
{% load humanize %}

{% block content %}
<div class="container" style="padding:28px 0">
  <h2 style="margin-bottom:16px">Registro de la reserva</h2>

  {% if error %}
    <div style="background:#ffecec;border:1px solid #f3b5b5;color:#b00020;padding:10px 12px;border-radius:10px;margin-bottom:12px">
      {{ error }}
    </div>
  {% endif %}

  <div class="checkout-grid">
    <!-- Columna izquierda: Fechas + Datos del titular -->
    <div class="card glass">
      <h3 class="card__title">Fechas y titular</h3>

      <form method="post" class="form" style="margin-top:10px">
        {% csrf_token %}
        <div class="field">
          <span class="label">Fecha de entrada</span>
          {{ form.check_in }}
        </div>
        <div class="field">
          <span class="label">Fecha de salida</span>
          {{ form.check_out }}
        </div>
        <div class="field">
          <span class="label">Huéspedes</span>
          {{ form.guests }}
        </div>

        <div class="card" style="grid-column:1/-1;background:#fff;padding:18px;border-radius:12px">
          <h3 class="card__title">Datos del titular</h3>

          <div class="field" style="margin-top:8px">
            <span class="label">Nombre completo</span>
            {{ form.holder_name }}
          </div>
          <div class="field">
            <span class="label">Email</span>
            {{ form.holder_email }}
          </div>
          <div class="field">
            <span class="label">Nacionalidad (opcional)</span>
            {{ form.nationality }}
          </div>

          <button class="btn btn--primary" style="margin-top:12px">Confirmar reserva</button>
        </div>
      </form>
    </div>

    <!-- Columna derecha: Resumen -->
    <div class="card" style="background:#fff;padding:18px;border-radius:12px">
      {# Imagen de la habitación #}
      {% with img=room.roomimage_set.first %}
        {% if img %}
          {% if img.image %}
            <img src="{{ img.image.url }}" alt="{{ room.name }}"
                 style="width:100%;height:210px;object-fit:cover;border-radius:10px;margin-bottom:10px">
          {% elif img.image_url %}
            <img src="{{ img.image_url }}" alt="{{ room.name }}"
                 style="width:100%;height:210px;object-fit:cover;border-radius:10px;margin-bottom:10px">
          {% else %}
            <div style="height:210px;background:#eee;border-radius:10px;margin-bottom:10px"></div>
          {% endif %}
        {% else %}
          {# Fallback local por categoría (igual que catálogo) #}
          {% if room.category|lower == "presidencial" %}
            <img src="{% static 'images/vip.jpg' %}" alt="{{ room.name }}"
                 style="width:100%;height:210px;object-fit:cover;border-radius:10px;margin-bottom:10px">
          {% elif room.category|lower == "ejecutiva" %}
            <img src="{% static 'images/eje.jpg' %}" alt="{{ room.name }}"
                 style="width:100%;height:210px;object-fit:cover;border-radius:10px;margin-bottom:10px">
          {% elif room.category|lower == "turista" %}
            <img src="{% static 'images/eco.png' %}" alt="{{ room.name }}"
                 style="width:100%;height:210px;object-fit:cover;border-radius:10px;margin-bottom:10px">
          {% else %}
            <div style="height:210px;background:#eee;border-radius:10px;margin-bottom:10px"></div>
          {% endif %}
        {% endif %}
      {% endwith %}

      <h3 style="margin:6px 0">{{ room.name }}</h3>
      <ul style="list-style:none;padding:0;margin:8px 0;color:#444">
        <li>Entrada: <b>{{ check_in|default:"—" }}</b></li>
        <li>Salida: <b>{{ check_out|default:"—" }}</b></li>
        <li>Huéspedes: <b>{{ guests|default:"—" }}</b></li>
        <li>Noches: <b>{{ nights }}</b></li>
        <li>Huéspedes: <b>{{ guests }}</b> <span style="color:#777">(máx. {{ room.capacity }})</span></li>
        <li>Precio por noche: <b>${{ room.price_per_night|intcomma }}</b></li>
        <li>Total estimado: <b>${{ total|floatformat:0|intcomma }}</b></li>

      </ul>
      <p style="font-size:12px;color:#777;margin:8px 0 0">
        * En el MVP se confirma la reserva; la simulación de pago la agregamos enseguida.
      </p>
    </div>
  </div>
</div>
{% endblock %}
